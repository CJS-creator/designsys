
# Project Restructuring Plan: Monorepo to Flat Structure

## Overview

This plan will move the web application from `apps/web/` to the root directory so Lovable can properly detect and build the project. The current monorepo structure is not compatible with Lovable's build system.

## Current Problem

Lovable requires these files at the root level:
- `index.html` - Currently at `apps/web/index.html`
- `vite.config.ts` - Currently at `apps/web/vite.config.ts`
- `src/` directory - Currently at `apps/web/src/`
- `package.json` with `dependencies` and `build:dev` script

The root `package.json` only has workspace configuration without dependencies.

## Migration Strategy

### Phase 1: Move Core Files to Root

Files to move from `apps/web/` to root:

| Source | Destination |
|--------|-------------|
| `apps/web/index.html` | `index.html` |
| `apps/web/vite.config.ts` | `vite.config.ts` |
| `apps/web/tailwind.config.ts` | `tailwind.config.ts` |
| `apps/web/postcss.config.js` | `postcss.config.js` |
| `apps/web/tsconfig.json` | `tsconfig.json` |
| `apps/web/tsconfig.app.json` | `tsconfig.app.json` |
| `apps/web/tsconfig.node.json` | `tsconfig.node.json` |
| `apps/web/components.json` | `components.json` |
| `apps/web/eslint.config.js` | `eslint.config.js` |
| `apps/web/vitest.config.ts` | `vitest.config.ts` |
| `apps/web/public/*` | `public/*` |

### Phase 2: Merge Source Directories

The root already has `src/integrations/supabase/` (auto-generated by Lovable Cloud). We need to:

1. Merge `apps/web/src/` into root `src/`
2. Keep existing `src/integrations/supabase/client.ts` and `types.ts`
3. Move all other source files from `apps/web/src/`

### Phase 3: Update Package.json

Replace root `package.json` with `apps/web/package.json` content, with these modifications:

```json
{
  "name": "designforge",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:dev": "vite build --mode development",
    "lint": "eslint .",
    "preview": "vite preview",
    "test": "vitest run",
    "test:watch": "vitest",
    "test:coverage": "vitest run --coverage",
    "test:ui": "vitest --ui"
  },
  "dependencies": {
    // All dependencies from apps/web/package.json
    // REMOVE: "@designsys/shared": "*"
  },
  "devDependencies": {
    // All devDependencies from apps/web/package.json
  }
}
```

### Phase 4: Update Vite Config

Modify `vite.config.ts` to update the shared package alias:

```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

export default defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
  },
  plugins: [
    react(),
    mode === "development" && componentTagger()
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
      // Update path - shared package is now at packages/shared
      "@designsys/shared": path.resolve(__dirname, "./packages/shared/src/index.ts"),
    },
  },
}));
```

### Phase 5: Inline Shared Package (Recommended)

Since the shared package only contains token type definitions, we should inline it to avoid the workspace dependency:

1. Copy `packages/shared/src/tokens.ts` content to `src/types/shared-tokens.ts`
2. Update all imports from `@designsys/shared` to `@/types/shared-tokens`

Files that import from `@designsys/shared`:
- Search for all usages and update imports

### Phase 6: Cleanup

Remove obsolete files and directories:
- `apps/` directory (after migration complete)
- `packages/` directory (after inlining shared types)
- Root workspace configuration from package.json

---

## Technical Details

### Files to Create at Root

1. **index.html** - Copy from `apps/web/index.html`
2. **vite.config.ts** - Modified version with updated paths
3. **tailwind.config.ts** - Copy from `apps/web/tailwind.config.ts`
4. **postcss.config.js** - Copy from `apps/web/postcss.config.js`
5. **tsconfig.json** - Copy from `apps/web/tsconfig.json`
6. **tsconfig.app.json** - Copy from `apps/web/tsconfig.app.json`
7. **tsconfig.node.json** - Keep existing or merge
8. **components.json** - Copy from `apps/web/components.json`
9. **eslint.config.js** - Copy from `apps/web/eslint.config.js`
10. **vitest.config.ts** - Copy from `apps/web/vitest.config.ts`
11. **package.json** - Merged version with all dependencies

### Source Directory Merge Strategy

```text
Root src/ (current):
└── integrations/
    └── supabase/
        ├── client.ts (keep - Lovable auto-generated)
        └── types.ts (keep - Lovable auto-generated)

apps/web/src/ (to merge):
├── App.css
├── App.tsx
├── index.css
├── main.tsx
├── vite-env.d.ts
├── components/
├── contexts/
├── data/
├── hooks/
├── lib/
├── pages/
├── test/
├── tests/
└── types/
    └── (add shared-tokens.ts here)
```

### Import Updates Required

Update all files that import from `@designsys/shared`:

```typescript
// Before
import { DesignToken, TokenType } from '@designsys/shared';

// After
import { DesignToken, TokenType } from '@/types/shared-tokens';
```

---

## Execution Order

1. Create new root config files (vite.config.ts, tailwind.config.ts, etc.)
2. Create new root package.json with all dependencies
3. Copy index.html to root
4. Copy public/ directory to root
5. Create src/types/shared-tokens.ts with inlined token types
6. Merge apps/web/src/* into root src/ (preserving existing integrations)
7. Update all @designsys/shared imports
8. Verify build works
9. Clean up apps/ and packages/ directories

---

## Risk Mitigation

- **Supabase Integration**: The existing `src/integrations/supabase/` files are auto-generated by Lovable Cloud and must be preserved
- **Import Paths**: All `@/` imports will continue to work since they resolve relative to src/
- **Build Scripts**: The `build:dev` script is included in the new package.json

## Expected Outcome

After this restructuring:
- Lovable will detect `index.html` and `vite.config.ts` at root
- `package.json` will have proper `dependencies` and `build:dev` script
- All source code will be in root `src/` directory
- Project will build successfully with `npm run build:dev`
